# 0001. Genome identifiers

Date: 2019-06-11

## Status

Agreed but will be superseeded

## Context

Many functions of the website require the context of a specific genome assembly and annotation set. Ensembl does not have a single identifier that can uniquely resolve each of our assemblies and to an active annotation set.

The existing fields that come closest to doing this are:

- **assembly_name** -  identifies an assembly for a given species, but is not unique outside of that species - many species use the same assembly name (e.g. “v1”)
- **assembly_accesion** - while the INSDC assembly accession is uniquely identifying, not all assemblies in Ensembl have one  
- **production_name** - in the context of specific Ensembl release this identifies a species and assembly, but is not unique across releases
- **genebuild_version** - Can point to a particular version of a gene set but fails to capture additional annotation e.g. regulation and variation

We propose creating a new identifier to uniquely identify genomes within Ensembl. This is intended to be system-level identifier and not for public distribution. However it is likely this identifier will leak.

## Decision

Genome IDs represent genomes, which are the combination of three facts:

- A species e.g. _Homo sapiens_
- An assembly e.g. GRCh38
- A group of annotations e.g. GENCODE30

We will generate genome IDs for each genome we want to display in the website. The IDs will be generated by combining two existing data fields to produce a unique string. While this composition will offer a degree of human readability it is not designed to be decomposed back into separate fields. The IDs will be generated by the back-end APIs and the web client (or other consumers) should not assume any knowledge of the ID format. This means all identifiers generated will be insufficient for future use (see proposed superseeded decision).

There may be exceptional cases where IDs are assigned manually and do not follow the format described here - this reinforces the need for clients and consumers to make no assumptions.

Currently all genomes handled by 2020 have one annotation set linked to them (a default set) as we do not support multiple genomes for a single assembly.

Once a genome ID has been assigned and released into production (meaning post Ensembl 2020's release) it cannot be changed.

Even though we believe the format must be changed in the future, this ADR represents the historical decision made by the web team based on known facts.

### Genome ID format

**NOTE: this format will change because it is insufficient to represent annotation sets**

`<production_name>_(<assembly_name> OR <assembly_accession>)`

Generally assemblies have names that we can use here, but in cases where there is no suitable name, assembly_accession will be used instead. Where assembly name is used, the patch build notation will be removed to avoid the need to update the IDs when new patch builds are made, e.g. `GRCh38.p12` becomes `GRCh38`.

To ensure the IDs are convenient to use in URLs, filenames, hash keys, etc, sanitisation will be applied to replace all non-alphanumeric character sequences with underscores, e.g. by applying a regular expression such as `s/[^a-zA-Z0-9]+/_/g`

## Consequences

While it is convenient to have a human readable genome ID format, a potential risk is that external users will make assumptions about how these IDs are composed. This may lead to attempts to parse out the species and assembly components from an ID, or attempts to compose an ID from the species and assembly components - the results of which may well be invalid.

At present, we feel the convenience of a human-readable format outweighs the potential risks.

By sanitising the ID (replacing non-alpha-numeric chars with underscores) we introduce the chance of a clash, e.g. given two strings `some_species_A-B` and `some_species_A+B`, the sanitised version is the same: `some_species_A_B`. The likelihood is low, but if a clash does occur a suitable ID will be generated manually.

### Why is this format insufficient?

`<production_name>_(<assembly_name> OR <assembly_accession>)` as an identifier resolves to the assembly level (the instance of assembled DNA which can be computed upon). Nothing in this identifier resolves to the level of annotation set i.e. the linkage of genes, variants and regulation data sets to an assembly. For example Ensembl releases 98 and 97 released a version of the Ensembl/GENCODE gene set called GENCODE32 and GENCODE31 respectively. If the current format of `genome_id` is followed, nothing can differentiate between these two genomes since they are both from _Homo sapiens_ and based on _GRCh38_. Patches do exist for human but this again assumes a gene set update will only happen on a genome with a patch system, which is an incorrect assumption.
